<%- include('headers.ejs'); %>
<div class="authentication-wrapper authentication-2 px-4">
	<div class="authentication-inner py-5">
<div class="card">
			<div class="p-4 p-sm-5">				
				<div class="display-1 lnr lnr-warning text-center text-danger mb-4"></div>

				<p class="text-center text-big mb-4">
Are you sure you want to delete <%= role.name %> role?</p>
											<% if (user.canDeleteRole){ %>												
												<input type="submit" name="submit" class="btn btn-danger" value="Delete" />

												&nbsp;
												<a class="btn btn-outline-secondary" href="/role/view/<%= role._id %>">
													No
												</a>
											<% } %>
                        </div>
                        
                        </div>
        
        </div>
  </div>
          <!-- / Content -->

				<!-- Layout footer -->
				<nav class="layout-footer footer bg-footer-theme">
					<div class="container-fluid d-flex flex-wrap justify-content-between text-center container-p-x pb-3">
						<div class="pt-3">
							<span class="footer-text font-weight-bolder">Arras.io</span> Â©
					</div>
				</nav>
				<!-- / Layout footer -->
			</div>
			<!-- Layout content -->
		</div>
		<!-- / Layout container -->
	</div>

	<!-- Overlay -->
	<div class="layout-overlay layout-sidenav-toggle"></div>
</div>
<!-- / Layout wrapper -->

<script>
	$('#deleteForm').submit(function(event) {
		event.preventDefault();
		$('input[type="submit"]').prop('disabled', true);

		const url = this.getAttribute('action');

		const data = {
			_id: getValueById('_id')
		};

		$.ajax({
			type: 'POST',
			data: JSON.stringify(data),
			contentType: 'application/json',
			url: url,
		})
		.done(
				function(data, textStatus, jqXHR){
					if (data.success){
						window.location.href = data.redirectUrl;
					} else {
						showMessagePanel(data.message);
					}
				}
		)
		.fail(
				function(jqXHR, textStatus, errorThrown){
					if (jqXHR.responseJSON){						
						showMessagePanel(jqXHR.responseJSON.message);
					} else {
						if (textStatus === 'error'){
							showMessagePanel('Unknown error.');
						}
					}
				}
		).always(
			function(){
				$('input[type="submit"]').prop('disabled', false);
			}
		);
	});

	function showMessagePanel(message){
		const element = document.getElementById('messagePanel');
		if (element){
			element.style.visibility = 'visible';
			element.textContent = message;
		}
	}

	function getValueById(elementId){
		return document.getElementById(elementId).value;
	}	
</script>

<%- include('footer'); %>